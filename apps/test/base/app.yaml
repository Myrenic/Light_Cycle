---
apiVersion: v1
kind: Namespace
metadata:
  name: test
---
apiVersion: v1
kind: Pod
metadata:
  name: hello-world-pod
  labels:
    app: hello-world
spec:
  containers:
    - name: hello-world-container
      image: crccheck/hello-world
      ports:
        - containerPort: 8000
---
apiVersion: v1
kind: Service
metadata:
  name: hello-world-service
spec:
  selector:
    app: hello-world
  ports:
    - protocol: TCP
      port: 80
      targetPort: 8000
---
apiVersion: traefik.containo.us/v1alpha1
kind: IngressRoute
metadata:
  name: hello-world-ingressroute
  namespace: test
spec:
  entryPoints:
    - websecure
  routes:
    - match: Host(`hello.ingress.tuntelder.com`)
      kind: Rule
      services:
        - name: hello-world-service
          port: 80
      middlewares:
        - name: crowdsec-mw
          namespace: traefik
  tls:
    certResolver: letsencrypt
