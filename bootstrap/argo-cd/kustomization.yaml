apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: argocd

resources:
- github.com/argoproj-labs/argocd-autopilot/manifests/base?ref=v0.4.19
- ./ingress.yaml


patchesJson6902:
  - target:
      group: ""
      version: v1
      kind: Service
      name: argocd-server
    path: service-remove-https-patch.yaml

configMapGenerator:
- behavior: merge
  literals:
  - kustomize.buildOptions=--enable-alpha-plugins --enable-helm
  - repository.credentials=[{"url":"https://github.com/","usernameSecret":{"name":"autopilot-secret","key":"git_username"},"passwordSecret":{"name":"autopilot-secret","key":"git_token"}}]
  name: argocd-cm
- behavior: merge
  literals:
  - server.insecure=true
  name: argocd-cmd-params-cm